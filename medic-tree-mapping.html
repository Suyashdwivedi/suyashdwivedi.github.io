<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ✅ Page Title -->
    <title>Medic Tree Mapping Campaign – Suyash Dwivedi</title>

    <!-- ✅ Meta Basics -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- ✅ SEO Meta Tags -->
    <meta name="description" content="Global campaign to map medicinal trees using Wikimedia Commons & OpenStreetMap. Developed by Wikimedian Suyash Dwivedi.">
    <meta name="keywords" content="Medicinal tree mapping, Wikimedia Commons, OpenStreetMap, World Environment Day, Wiki Club SATI, Suyash Dwivedi, CPUG, tree mapping">
    <meta name="author" content="Suyash Dwivedi">

    <!-- ✅ Open Graph Tags -->
    <meta property="og:title" content="Medic Tree Mapping Campaign – by Suyash Dwivedi">
    <meta property="og:description" content="Mapping medicinal trees globally with Wikimedia Commons and OpenStreetMap.">
    <meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9c/Suyash_Dwivedi_01%28cropped%29.jpg/180px-Suyash_Dwivedi_01%28cropped%29.jpg">
    <meta property="og:url" content="https://suyashdwivedi.github.io/medic-tree-mapping.html">
    <meta property="og:type" content="website">

    <!-- ✅ Twitter Card -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Medic Tree Mapping – by Suyash Dwivedi">
    <meta name="twitter:description" content="Wikimedia + OSM based campaign to map medicinal trees worldwide.">
    <meta name="twitter:image" content="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9c/Suyash_Dwivedi_01%28cropped%29.jpg/180px-Suyash_Dwivedi_01%28cropped%29.jpg">

    <!-- ✅ Favicon (your original) -->
    <link rel="icon" href="https://raw.githubusercontent.com/Suyashdwivedi/suyashdwivedi.github.io/refs/heads/main/tree.png" />

    <!-- ✅ Canonical URL -->
    <link rel="canonical" href="https://suyashdwivedi.github.io/medic-tree-mapping.html" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        body, html { height: 100%; margin: 0; font-family: sans-serif; }
        #map { height: calc(100% - 150px); width: 100%; }
        header {
            text-align: center; padding: 10px;
            background-color: #4caf50; color: white; position: relative;
        }
        header h1 { margin: 0; }
        header p { margin: 4px 0 0 0; font-size: 14px; }
        .logo-left, .logo-right { position: absolute; top: 5px; }
        .logo-left { left: 10px; }
        .logo-right { right: 10px; }
        .controls-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background-color: #f8f8f8;
            border-bottom: 1px solid #ddd;
        }
        .dropdown-container {
            position: static;
            background: none;
            padding: 0;
            box-shadow: none;
        }
        #imageCount {
            position: static;
            background: none;
            padding: 0;
            box-shadow: none;
            color: #333;
            font-size: 14px;
            font-weight: bold;
        }
        select { padding: 5px; font-size: 14px; }
        footer {
            background-color: #f1f1f1;
            text-align: center;
            padding: 8px;
            font-size: 13px;
        }
    </style>
</head>

<body>

<header>
    <a class="logo-left" href="https://commons.wikimedia.org/wiki/Commons:Commons_Photographers_User_Group" target="_blank">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/f1/Commons-Photographers_User_Group-logo-en.svg/250px-Commons_Photographers_User_Group-logo-en.svg.png" alt="CPUG logo" style="height: 75px;">
    </a>
    <a class="logo-right" href="https://meta.wikimedia.org/wiki/Wiki_Club_SATI/Events/World_Environment_Day_2025" target="_blank">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/4b/WIKI_CLUB_SATI_Logo_White.svg/250px-WIKI_CLUB_SATI_Logo_White.svg.png" alt="WIKI CLUB SATI logo" style="height: 75px;">
    </a>
    <h1>Medic Tree Mapping Campaign</h1>
    <p>Mapping medicinal trees through Wikimedia Commons & OpenStreetMap</p>
    Developed by <a href="https://meta.wikimedia.org/wiki/User:Suyash.dwivedi" target="_blank">Suyash Dwivedi</a>  <a href="https://suyashdwivedi.github.io/mtm.html" target="_blank"> |Other Map</a>
</header>

<div class="controls-container">
    <div class="dropdown-container">
        <label for="treeCategory"><strong>Select Campaign:</strong></label>
        <select id="treeCategory" onchange="onCategoryChange(this.value)">
            <option value="">-- Show All --</option>
            <!-- All countries option (unchanged) -->
            <option value="Medic_Tree_Mapping_in_India_on_WED_2025">India</option>
            <!-- Truncated for brevity. Keep your full country list here. -->
        </select>
    </div>
    <div id="imageCount"></div>
</div>

<div id="map"></div>

<footer>
    Developed by <a href="https://meta.wikimedia.org/wiki/User:Suyash.dwivedi" target="_blank">Suyash Dwivedi</a> | Last update: 07 July 2025
</footer>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const treeIcon = L.icon({
    iconUrl: 'https://suyashdwivedi.github.io/tree_32px.png',
    iconSize: [25, 25],
    iconAnchor: [12.5, 41],
    popupAnchor: [0, -41]
});

const map = L.map('map').setView([20, 0], 2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

let currentMarkers = [];
let totalImageCount = 0;

function updateImageCountDisplay(count) {
    document.getElementById('imageCount').innerText = `Trees Mapped: ${count}`;
}

function clearMarkers() {
    currentMarkers.forEach(marker => map.removeLayer(marker));
    currentMarkers = [];
    totalImageCount = 0;
    updateImageCountDisplay(totalImageCount);
}

function onCategoryChange(value) {
    clearMarkers();
    if (value === "") {
        loadAllSubcategories('Medic_Tree_Mapping_on_WED_2025', 3);
    } else {
        loadCategoryImages(value, true);
    }
}

async function getSubcategories(category, depth = 1, maxDepth = 3, seen = new Set()) {
    if (depth > maxDepth || seen.has(category)) return [];
    seen.add(category);
    let subcats = [category];
    const url = `https://commons.wikimedia.org/w/api.php?action=query&list=categorymembers&cmtitle=Category:${encodeURIComponent(category)}&cmtype=subcat&cmlimit=500&format=json&origin=*`;
    const res = await fetch(url);
    const data = await res.json();
    const members = data.query?.categorymembers || [];

    for (const m of members) {
        const title = m.title.replace("Category:", "");
        const children = await getSubcategories(title, depth + 1, maxDepth, seen);
        subcats.push(...children);
    }
    return subcats;
}

async function loadAllSubcategories(rootCategory, maxDepth = 3) {
    clearMarkers();
    const allCats = await getSubcategories(rootCategory, 1, maxDepth);
    totalImageCount = 0;
    const promises = allCats.map(cat => loadCategoryImages(cat, false));
    await Promise.all(promises);
    if (currentMarkers.length > 0) {
        const group = L.featureGroup(currentMarkers);
        map.fitBounds(group.getBounds().pad(0.2));
    }
    updateImageCountDisplay(totalImageCount);
}

async function loadCategoryImages(category, zoom = true) {
    let gcmcontinue = null;
    let categoryImageCount = 0;
    do {
        const params = new URLSearchParams({
            action: 'query',
            generator: 'categorymembers',
            gcmtitle: `Category:${category}`,
            gcmtype: 'file',
            gcmprop: 'ids|title',
            prop: 'coordinates|imageinfo',
            iiprop: 'url',
            iiurlwidth: '200',
            format: 'json',
            origin: '*',
            gcmcontinue: gcmcontinue || ''
        });

        const url = `https://commons.wikimedia.org/w/api.php?${params.toString()}`;

        try {
            const response = await fetch(url);
            const data = await response.json();
            const pages = data.query?.pages || {};

            for (const pageId in pages) {
                const page = pages[pageId];
                if (page.coordinates && page.imageinfo) {
                    const coord = page.coordinates[0];
                    const imgUrl = page.imageinfo[0].thumburl || page.imageinfo[0].url;
                    const title = page.title;
                    const link = `https://commons.wikimedia.org/wiki/${encodeURIComponent(title)}`;

                    const marker = L.marker([coord.lat, coord.lon], { icon: treeIcon })
                        .addTo(map)
                        .bindPopup(`<a href="${link}" target="_blank"><img src="${imgUrl}" width="150"><br>${title}</a>`);

                    currentMarkers.push(marker);
                    categoryImageCount++;
                }
            }

            gcmcontinue = data.continue?.gcmcontinue;
        } catch (e) {
            console.error("Failed to load images for category:", category, e);
            break;
        }
    } while (gcmcontinue);

    totalImageCount += categoryImageCount;
    if (zoom && currentMarkers.length > 0) {
        updateImageCountDisplay(totalImageCount);
        const group = L.featureGroup(currentMarkers);
        map.fitBounds(group.getBounds().pad(0.2));
    }
}

window.onload = () => {
    loadAllSubcategories('Medic_Tree_Mapping_on_WED_2025', 3);
};
</script>

<!-- ✅ Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GC8PGC89NB"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-GC8PGC89NB');
</script>

<!-- ✅ counter.dev -->
<script src="https://cdn.counter.dev/script.js"
        data-id="cc7a036d-a904-4d76-bcac-37ea4196c014"
        data-utcoffset="6">
</script>

</body>
</html>
