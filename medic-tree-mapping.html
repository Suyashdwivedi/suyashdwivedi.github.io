<!DOCTYPE html>
<html>
<head>
    <title>Medic Tree Mapping Campaign</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body, html {
            height: 100%;
            margin: 0;
            font-family: sans-serif;
        }

        #map {
            height: calc(100% - 120px);
            width: 100%;
        }

        header {
            text-align: center;
            padding: 10px;
            background-color: #4caf50;
            color: white;
            position: relative;
        }

        header h1 {
            margin: 0;
        }

        header p {
            margin: 4px 0 0 0;
            font-size: 14px;
        }

        .logo-left {
            position: absolute;
            top: 5px;
            left: 10px;
        }

        .logo-right {
            position: absolute;
            top: 5px;
            right: 10px;
        }

        .dropdown-container {
            position: absolute;
            top: 70px;
            left: 10px;
            z-index: 1000;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 0 6px rgba(0,0,0,0.3);
        }

        select {
            padding: 5px;
            font-size: 14px;
        }

        footer {
            background-color: #f1f1f1;
            text-align: center;
            padding: 8px;
            font-size: 13px;
        }
    </style>
</head>
<body>

<header>
    <a class="logo-left" href="https://commons.wikimedia.org/wiki/Commons:Commons_Photographers_User_Group" target="_blank">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/f1/Commons-Photographers_User_Group-logo-en.svg/330px-Commons-Photographers_User_Group-logo-en.svg.png" alt="CPUG logo" style="height: 75px;">
    </a>
    <a class="logo-right" href="https://meta.wikimedia.org/wiki/Wiki_Club_SATI/Events/World_Environment_Day_2025" target="_blank">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/bb/WIKI_CLUB_SATI_Logo.svg/250px-WIKI_CLUB_SATI_Logo.svg.png" alt="WIKI CLUB SATI logo" style="height: 75px;">
    </a>
    <h1>Medic Tree Mapping Campaign</h1>
    <p>Mapping medicinal trees through Wikimedia Commons & OpenStreetMap </p>
	Developed by <a href="https://meta.wikimedia.org/wiki/User:Suyash.dwivedi" target="_blank">Suyash Dwivedi</a>
	
</header>
<div class="dropdown-container">
    <label for="treeCategory"><strong>Select Campaign:</strong></label>
    <select id="treeCategory" onchange="onCategoryChange(this.value)">
        <option value="">-- Show All --</option>

        <!-- North America -->
        <option value="Medic_Tree_Mapping_in_United_States_on_WED_2025">United States</option>
        <option value="Medic_Tree_Mapping_in_Canada_on_WED_2025">Canada</option>
        <option value="Medic_Tree_Mapping_in_Mexico_on_WED_2025">Mexico</option>

        <!-- South America -->
        <option value="Medic_Tree_Mapping_in_Brazil_on_WED_2025">Brazil</option>
        <option value="Medic_Tree_Mapping_in_Argentina_on_WED_2025">Argentina</option>
        <option value="Medic_Tree_Mapping_in_Colombia_on_WED_2025">Colombia</option>
        <option value="Medic_Tree_Mapping_in_Chile_on_WED_2025">Chile</option>
        <option value="Medic_Tree_Mapping_in_Peru_on_WED_2025">Peru</option>

        <!-- Europe -->
        <option value="Medic_Tree_Mapping_in_Germany_on_WED_2025">Germany</option>
        <option value="Medic_Tree_Mapping_in_France_on_WED_2025">France</option>
        <option value="Medic_Tree_Mapping_in_United_Kingdom_on_WED_2025">United Kingdom</option>
        <option value="Medic_Tree_Mapping_in_Italy_on_WED_2025">Italy</option>
        <option value="Medic_Tree_Mapping_in_Spain_on_WED_2025">Spain</option>
        <option value="Medic_Tree_Mapping_in_Russia_on_WED_2025">Russia</option>

        <!-- Asia -->
        <option value="Medic_Tree_Mapping_in_China_on_WED_2025">China</option>
        <option value="Medic_Tree_Mapping_in_India_on_WED_2025">India</option>
        <option value="Medic_Tree_Mapping_in_Japan_on_WED_2025">Japan</option>
        <option value="Medic_Tree_Mapping_in_South_Korea_on_WED_2025">South Korea</option>
        <option value="Medic_Tree_Mapping_in_Indonesia_on_WED_2025">Indonesia</option>
        <option value="Medic_Tree_Mapping_in_Saudi_Arabia_on_WED_2025">Saudi Arabia</option>
        <option value="Medic_Tree_Mapping_in_Turkey_on_WED_2025">Turkey</option>

        <!-- Africa -->
        <option value="Medic_Tree_Mapping_in_Nigeria_on_WED_2025">Nigeria</option>
        <option value="Medic_Tree_Mapping_in_South_Africa_on_WED_2025">South Africa</option>
        <option value="Medic_Tree_Mapping_in_Egypt_on_WED_2025">Egypt</option>
        <option value="Medic_Tree_Mapping_in_Kenya_on_WED_2025">Kenya</option>
        <option value="Medic_Tree_Mapping_in_Ethiopia_on_WED_2025">Ethiopia</option>

        <!-- Oceania -->
        <option value="Medic_Tree_Mapping_in_Australia_on_WED_2025">Australia</option>
        <option value="Medic_Tree_Mapping_in_New_Zealand_on_WED_2025">New Zealand</option>
        <option value="Medic_Tree_Mapping_in_Papua_New_Guinea_on_WED_2025">Papua New Guinea</option>

        <!-- Middle East -->
        <option value="Medic_Tree_Mapping_in_Iran_on_WED_2025">Iran</option>
        <option value="Medic_Tree_Mapping_in_Iraq_on_WED_2025">Iraq</option>
        <option value="Medic_Tree_Mapping_in_Israel_on_WED_2025">Israel</option>
        <option value="Medic_Tree_Mapping_in_United_Arab_Emirates_on_WED_2025">United Arab Emirates</option>
        <option value="Medic_Tree_Mapping_in_Qatar_on_WED_2025">Qatar</option>
    </select>
</div>

<div id="map"></div>

<footer>
    Developed by <a href="https://meta.wikimedia.org/wiki/User:Suyash.dwivedi" target="_blank">Suyash Dwivedi</a> | Last update: 9 June 2025
</footer>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const map = L.map('map').setView([20, 0], 2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

let currentMarkers = [];

function clearMarkers() {
    currentMarkers.forEach(marker => map.removeLayer(marker));
    currentMarkers = [];
}

function onCategoryChange(value) {
    clearMarkers();
    if (value === "") {
        loadAllSubcategories('Medic_Tree_Mapping_on_WED_2025', 3);
    } else {
        loadCategoryImages(value);
    }
}

async function getSubcategories(category, depth = 1, maxDepth = 3, seen = new Set()) {
    if (depth > maxDepth || seen.has(category)) return [];
    seen.add(category);
    let subcats = [category];

    const url = `https://commons.wikimedia.org/w/api.php?action=query&list=categorymembers&cmtitle=Category:${encodeURIComponent(category)}&cmtype=subcat&cmlimit=500&format=json&origin=*`;
    const res = await fetch(url);
    const data = await res.json();
    const members = data.query?.categorymembers || [];

    for (const m of members) {
        const title = m.title.replace("Category:", "");
        const children = await getSubcategories(title, depth + 1, maxDepth, seen);
        subcats.push(...children);
    }

    return subcats;
}

async function loadAllSubcategories(rootCategory, maxDepth = 3) {
    clearMarkers();
    const allCats = await getSubcategories(rootCategory, 1, maxDepth);
    const promises = allCats.map(cat => loadCategoryImages(cat, false));
    await Promise.all(promises);
    if (currentMarkers.length > 0) {
        const group = L.featureGroup(currentMarkers);
        map.fitBounds(group.getBounds().pad(0.2));
    }
}

async function loadCategoryImages(category, zoom = true) {
    const url = `https://commons.wikimedia.org/w/api.php?action=query&generator=categorymembers&gcmtitle=Category:${encodeURIComponent(category)}&gcmtype=file&gcmprop=ids|title&prop=coordinates|imageinfo&iiprop=url&iiurlwidth=200&format=json&origin=*`;

    try {
        const response = await fetch(url);
        const data = await response.json();
        const pages = data.query?.pages || {};

        for (const pageId in pages) {
            const page = pages[pageId];
            if (page.coordinates && page.imageinfo) {
                const coord = page.coordinates[0];
                const imgUrl = page.imageinfo[0].thumburl || page.imageinfo[0].url;
                const title = page.title;
                const link = `https://commons.wikimedia.org/wiki/${encodeURIComponent(title)}`;

                const marker = L.marker([coord.lat, coord.lon])
                    .addTo(map)
                    .bindPopup(`<a href="${link}" target="_blank"><img src="${imgUrl}" width="150"><br>${title}</a>`);
                
                currentMarkers.push(marker);
            }
        }

        if (zoom && currentMarkers.length > 0) {
            const group = L.featureGroup(currentMarkers);
            map.fitBounds(group.getBounds().pad(0.2));
        }
    } catch (e) {
        console.error("Failed to load images for category:", category, e);
    }
}

// Load everything by default on page load
window.onload = () => {
    loadAllSubcategories('Medic_Tree_Mapping_on_WED_2025', 3);
};
</script>

</body>
</html>
