scientistsData.forEach((scientist, index) => {
    if (!uniqueScientists[scientist.name]) {
        uniqueScientists[scientist.name] = {
            index,
            field: scientist.field,
            birthplace: scientist.birthplace,
            country: scientist.country,
            article: scientist.article,
            image: scientist.image,
            wikidata: scientist.wikidata,
            coordinates: scientist.coordinates
        };

        const birthplaceLink = `https://en.wikipedia.org/wiki/${encodeURIComponent(scientist.birthplace.replace(/ /g,'_'))}`;

        // Add scientist details with Wikidata link and image to the table
        tableBody.append("tr")
          .html(`
            <td>${index + 1}</td>
            <td>
              <a href="${scientist.article || '#'}" target="_blank">${scientist.name}</a>
              (<a href="${scientist.wikidata}" target="_blank">Wikidata</a>)
            </td>
            <td>${scientist.field}</td>
            <td><a href="${birthplaceLink}" target="_blank">${scientist.birthplace}</a></td>
            <td>${scientist.country}</td>
          `);
    }
});

// Add map markers with popup content
Object.values(uniqueScientists).forEach(scientist => {
    const marker = L.marker(scientist.coordinates).addTo(map);

    const wikiLink = scientist.article || `https://en.wikipedia.org/wiki/${encodeURIComponent(scientist.name.replace(/ /g,'_'))}`;

    const popupContent = `
        <b><a href="${wikiLink}" target="_blank">${scientist.name}</a></b><br />
        ${scientist.field}<br />
        <a href="${birthplaceLink}" target="_blank">${scientist.birthplace}</a><br />
        ${scientist.country}<br />
        ${scientist.image ? `<img src="${scientist.image}" alt="${scientist.name}" style="width:auto;height:auto;max-width:150px;">` : 'Image N/A'}<br />
        (<a href="${scientist.wikidata}" target="_blank">Wikidata</a>)
    `;
    marker.bindPopup(popupContent);
});
