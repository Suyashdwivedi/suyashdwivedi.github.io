<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historical Figures Born by Region</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f4f4f4;
        }
        svg {
            width: 100%;
            height: 90vh;
        }
    </style>
</head>
<body>

<svg id="map"></svg>

<script>
    // SPARQL query to get historical figures, their birthplaces, and birth years
    const sparqlQuery = `
    SELECT ?person ?personLabel ?placeLabel ?birthYear ?placeCoord WHERE {
      ?person wdt:P31 wd:Q5;              # Entity must be a human
              wdt:P569 ?birthDate;         # Birth date property
              wdt:P19 ?place.              # Place of birth property
      ?place wdt:P625 ?placeCoord.         # Get coordinates for the birthplace
      BIND(YEAR(?birthDate) AS ?birthYear)
      FILTER(?birthYear > 1800 && ?birthYear < 2000)   # Birth year range
      SERVICE wikibase:label { bd:serviceParam wikibase:language "[AUTO_LANGUAGE],en". }
    }
    LIMIT 100`;

    // Fetch function to get the data from Wikidata SPARQL endpoint
    fetch("https://query.wikidata.org/sparql?query=" + encodeURIComponent(sparqlQuery) + "&format=json")
      .then(response => response.json())
      .then(data => {
          // Parse the results into an array of people with coordinates
          const peopleData = data.results.bindings.map(person => {
              const coords = person.placeCoord.value.replace('Point(', '').replace(')', '').split(' ');
              return {
                  name: person.personLabel.value,
                  birthplace: [parseFloat(coords[0]), parseFloat(coords[1])],
                  year: person.birthYear.value
              };
          });
          
          // Set up dimensions for the map
          const width = 960, height = 600;

          // Create SVG container
          const svg = d3.select("#map")
                        .attr("width", width)
                        .attr("height", height);

          // Define map projection and path generator
          const projection = d3.geoNaturalEarth1()
                               .scale(160)
                               .translate([width / 2, height / 2]);

          const path = d3.geoPath().projection(projection);

          // Load the world map data
          d3.json("https://unpkg.com/world-atlas@2.0.0/world/110m.json").then(worldData => {
              const countries = topojson.feature(worldData, worldData.objects.countries).features;

              // Draw the world map
              svg.selectAll("path")
                 .data(countries)
                 .enter().append("path")
                 .attr("fill", "#c4c4c4")
                 .attr("d", path)
                 .style("stroke", "#333");

              // Plot people on the map based on the coordinates
              svg.selectAll("circle")
                 .data(peopleData)
                 .enter().append("circle")
                 .attr("cx", d => projection(d.birthplace)[0])
                 .attr("cy", d => projection(d.birthplace)[1])
                 .attr("r", 5)
                 .attr("fill", "red")
                 .attr("stroke", "black")
                 .attr("stroke-width", 1)
                 .on("mouseover", function (event, d) {
                     d3.select(this)
                       .attr("r", 10)
                       .attr("fill", "blue");
                 })
                 .on("mouseout", function () {
                     d3.select(this)
                       .attr("r", 5)
                       .attr("fill", "red");
                 })
                 .append("title")  // Tooltip on hover
                 .text(d => `${d.name} (Born: ${d.year})`);
          });
      })
      .catch(error => console.error('Error fetching or parsing data:', error));
</script>

</body>
</html>
